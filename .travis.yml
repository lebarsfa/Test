language: cpp

if: tag IS blank

env:
    - TRAVIS_TAG="autotagname"

deploy: &deploy_base
    provider: releases
    tag_name: ${TRAVIS_TAG}
    api_key:
        secure: XswJJhiDn1DDUMmivWdj/Mfz6IzHexWRgMZoVmcM2gEB9/P8XUgHPL5dpmo+Ep81ILM4Niug7XBE4+EmAMAV/5pPclxfLM47jhBXciG0UQA6BgANI0s630qqVP3/KWh8cxeA3YV87jyf5fvEPwo8KaiNfOIxnVeHraeOjfGPYXPWSHXzTvcz99ZeJMIyk3006PSGPNEhMUbKm6k/eYnJsfQnUIgq6nICRMiGxfhDrh5mVwW9xIDKDqc3vpm6d00pCMmrjbG9c6rh8UD0lfXHV4vs8gDJh1+sK+D2EnPIYKOmjRqb4m8RAnAkd/NBoBenLYPWJgazOziID8P58fcElxttBouMPz3bYbsOize4gPk1KZniKbHVtn+aqQ5fOIiDOv7TyyZRS5Barln8xfOPZje1R/EgdiSj0PabvyhSf/hemRJMCi0yJ7tUklLvIZqPCz76uN9uPAzmWtwisGYiYeJXV5ZffLZeY7Yo4xxVir00mSWZWO3qPnwZlku4T3rLFST5emx4kxsFCfGaicaMjn/YQ4m+ZWXpL5dxgR6IHSKEROK50TqZWA1vb+YH58Zg5xkrd5+4bFALrlE5pA61LDET06nM+m5IjIFurALodi6uHKISfD8yiynCQMFbcNFf+mVroJf1ATlk32GFDakgmXbgtSlmVwUOAYDUtIqMqi8=
    skip_cleanup: true
    overwrite: true
    file_glob: true
    draft: true
    prerelease: true

jobs:
  include: 
   - name: "Ubuntu 18.04"
     os: linux
     dist: bionic
     compiler: gcc
     before_install: 
       - sudo apt-get -q update || true
       - sudo apt-get -y install flex bison || true
     script: 
       - git clone -b develop https://github.com/lebarsfa/ibex-lib.git
       - cd ibex-lib
       - mkdir build ; cd build
       - cmake -D CMAKE_INSTALL_PREFIX="../../ibex" -D CMAKE_CXX_FLAGS="-fPIC" -D CMAKE_C_FLAGS="-fPIC" ..
       - cmake --build . --target install
       - cd ../..
       - git clone -b windows https://github.com/lebarsfa/tubex-lib
       - cd tubex-lib 
       - git submodule init ; git submodule update
       - mkdir build ; cd build
       - cmake -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" ..
       - cmake --build . --target install
       - cd ../..
       # Test C++ program and bundle...
       - wget http://www.ensta-bretagne.fr/lebars/Share/tubex_test_win.zip
       - unzip -q -o tubex_test_win.zip
       - rm -Rf tubex_test_win.zip
       - cd tubex_test_win
       - mv test ..
       - cd ../test
       - rm -Rf ../tubex_test_win
       - cmake .
       - cmake --build .
       - ./my_project

   - name: "Ubuntu 18.04 C++ Python"
     os: linux
     dist: bionic
     compiler: gcc
     language: python
     python: 3.8
     before_install: 
       - python --version || true
       - python3 --version || true
       - pip --version || true
       - pip3 --version || true
       - sudo python --version || true
       - sudo python3 --version || true
       - sudo pip --version || true
       - sudo pip3 --version || true
       - sudo apt-get -q update || true
       - sudo apt-get -y install flex bison || true
       - sudo apt-get -y install doxygen graphviz || true
       #
       #sudo apt-get -y install python3-pip python3-setuptools python3-wheel python3-breathe
       #sudo pip3 install --upgrade pip
       #sudo pip3 install --upgrade pyIbex
       #
       #sudo apt-get -y install python3.8-dev
       #sudo update-alternatives --install /usr/bin/python python /usr/bin/python3.8 1
       #sudo python -m pip install --upgrade pip
       #sudo python -m pip install --upgrade pyIbex
       #sudo python -m pip install --upgrade setuptools wheel
       #
       - pip install --upgrade pip
       - pip install --upgrade pyIbex
       - pip install --upgrade setuptools wheel
     script: 
       - git clone -b develop https://github.com/lebarsfa/ibex-lib.git
       - cd ibex-lib
       - mkdir build ; cd build
       - cmake -D CMAKE_INSTALL_PREFIX="../../ibex" -D CMAKE_CXX_FLAGS="-fPIC" -D CMAKE_C_FLAGS="-fPIC" ..
       - cmake --build . --target install
       - cd ../..
       - git clone -b windows https://github.com/lebarsfa/tubex-lib
       - cd tubex-lib 
       - git submodule init ; git submodule update
       - mkdir build ; cd build
       - cmake -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" -D CMAKE_BUILD_TYPE=Debug -D WITH_PYTHON=ON -D CMAKE_CXX_FLAGS="-fPIC" ..
       - cmake --build . --target api
       - cmake -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" -D CMAKE_BUILD_TYPE=Debug -D WITH_PYTHON=ON -D CMAKE_CXX_FLAGS="-fPIC" ..
       - cmake --build . --target install
       - cmake --build . --target pip_package
       # Test python program and wheel...
       - cp *.whl ../../
       #sudo pip3 install ../../*.whl
       #sudo python -m pip install ../../*.whl
       - pip install ../../*.whl
       - python ../examples/tuto/01_getting_started/01_getting_started.py
       - cd ../..
       # Test C++ program and bundle...
       - wget http://www.ensta-bretagne.fr/lebars/Share/tubex_test_win.zip
       - unzip -q -o tubex_test_win.zip
       - rm -Rf tubex_test_win.zip
       - cd tubex_test_win
       - mv test ..
       - cd ../test
       - rm -Rf ../tubex_test_win
       - cmake .
       - cmake --build .
       - ./my_project
     deploy:
       <<: *deploy_base
       file: "*.whl"

#   - name: "Raspbian Buster pi Docker"
#     os: linux
#     dist: bionic
#     compiler: gcc
#     services:
#       - docker
#     before_install: 
#       - docker run --rm --privileged multiarch/qemu-user-static:register --reset
#     script: 
#       - "docker run -i -v \"${PWD}/..:${PWD}/..\" lebarsfa/pi:buster /bin/bash -c \"uname -a && cat /etc/os-release && cd ${PWD} && apt-get -q update && apt-get -y install sudo lsb-release wget unzip build-essential cmake git flex bison && lsb_release -a && git clone -b develop https://github.com/lebarsfa/ibex-lib.git && cd ibex-lib && mkdir build ; cd build && cmake -D CMAKE_INSTALL_PREFIX=../../ibex -D CMAKE_CXX_FLAGS=-fPIC -D CMAKE_C_FLAGS=-fPIC -D INTERVAL_LIB=filib .. && cmake --build . --target install && cd ../.. && git clone -b windows https://github.com/lebarsfa/tubex-lib && cd tubex-lib && git submodule init ; git submodule update && mkdir build ; cd build && cmake -D CMAKE_PREFIX_PATH=../ibex -D CMAKE_INSTALL_PREFIX=../../tubex .. && cmake --build . --target install && cd ../.. && wget http://www.ensta-bretagne.fr/lebars/Share/tubex_test_win.zip && unzip -q -o tubex_test_win.zip && rm -Rf tubex_test_win.zip && cd tubex_test_win && mv test .. && cd ../test && rm -Rf ../tubex_test_win && cmake . && cmake --build . && ./my_project \""

   - name: "Mac OS Xcode 10.1"
     os: osx
     osx_image: xcode10.1
     script: 
       - git clone -b develop https://github.com/lebarsfa/ibex-lib.git
       - cd ibex-lib
       - mkdir build ; cd build
       - cmake -D CMAKE_INSTALL_PREFIX="../../ibex" -D CMAKE_CXX_FLAGS="-fPIC -Wno-everything" -D CMAKE_C_FLAGS="-fPIC -Wno-everything" ..
       - cmake --build . --target install
       - cd ../..
       - git clone -b windows https://github.com/lebarsfa/tubex-lib
       - cd tubex-lib 
       - git submodule init ; git submodule update
       - mkdir build ; cd build
       - cmake -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" ..
       - cmake --build . --target install
       - cd ../..
       # Test C++ program and bundle...
       - wget http://www.ensta-bretagne.fr/lebars/Share/tubex_test_win.zip
       - unzip -q -o tubex_test_win.zip
       - rm -Rf tubex_test_win.zip
       - cd tubex_test_win
       - mv test ..
       - cd ../test
       - rm -Rf ../tubex_test_win
       - cmake .
       - cmake --build .
       - ./my_project

   - name: "Windows Visual Studio 2019 x86 C++"
     os: windows
     before_install: 
       - choco install -y visualstudio2019buildtools visualstudio2019-workload-vctools winflexbison
     script: 
       - git clone -b develop https://github.com/lebarsfa/ibex-lib.git
       - cd ibex-lib
       - mkdir build ; cd build
       - cmake -G "Visual Studio 16" -A Win32 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_INSTALL_PREFIX="../../ibex" -D INTERVAL_LIB=filib ..
       - cmake --build . --config Release --target install
       - cd ../..
       - git clone -b windows https://github.com/lebarsfa/tubex-lib
       - cd tubex-lib 
       - git submodule init
       - git submodule update
       - mkdir build
       - cd build
       - cmake -G "Visual Studio 16" -A Win32 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" ..
       - cmake --build . --config Debug --target install
       - cd ../..
       # Test C++ program and bundle...
       - wget http://www.ensta-bretagne.fr/lebars/Share/tubex_test_win.zip
       - 7z x tubex_test_win.zip -y
       - rm -Rf tubex_test_win.zip
       - cd tubex_test_win
       - rm -Rf ibex tubex ReadMe.txt
       - mv ../ibex .
       - mv ../tubex .
       - cd ..
       - 7z a -y tubex_test_x86_vc16.zip tubex_test_win
       - cd tubex_test_win/test
       - cmake -G "Visual Studio 16" -A Win32 .
       - cmake --build . --config Release
       - cmd //c "Release\my_project.exe"
       - cd ../..
     deploy:
       <<: *deploy_base
       file: 
         - "*.zip"

   - name: "Windows Visual Studio 2019 x64 C++ Python 3.8"
     os: windows
     before_install: 
       - choco install -y visualstudio2019buildtools visualstudio2019-workload-vctools winflexbison
       - cmd //c "choco install -y doxygen.install graphviz & choco install -y python --version=3.8.3 & refreshenv.cmd & python -m pip install --upgrade pip & pip install --upgrade pyIbex & pip install --upgrade wheel setuptools & git clone -b v3.1.1 https://github.com/sphinx-doc/sphinx & cd sphinx & pip install . & pip install --upgrade breathe sphinx-tabs sphinx_rtd_theme & refreshenv.cmd"
       - export PATH=/c/Python38:/c/Python38/Scripts:$PATH
     script: 
       - git clone -b develop https://github.com/lebarsfa/ibex-lib.git
       - cd ibex-lib
       - mkdir build ; cd build
       - cmake -G "Visual Studio 16" -A x64 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_INSTALL_PREFIX="../../ibex" -D INTERVAL_LIB=filib ..
       - cmake --build . --config Release --target install
       - cd ../..
       - git clone -b windows https://github.com/lebarsfa/tubex-lib
       - cd tubex-lib 
       - git submodule init
       - git submodule update
       - mkdir build
       - cd build
       - cmake -G "Visual Studio 16" -A x64 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" -D WITH_PYTHON=ON ..
       - cmake --build . --config Debug --target api
       - cmake -G "Visual Studio 16" -A x64 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" -D WITH_PYTHON=ON ..
       - cmake --build . --config Debug --target install
       - cmake --build . --config Debug --target pip_package
       # Test python program and wheel...
       - cp *.whl ../../tubex_lib-X.X.X-cp38-cp38-win_amd64.whl
       - pip install ../../tubex_lib-X.X.X-cp38-cp38-win_amd64.whl
       - python ../examples/tuto/01_getting_started/01_getting_started.py
       - cd ../..
       # Test C++ program and bundle...
       - wget http://www.ensta-bretagne.fr/lebars/Share/tubex_test_win.zip
       - 7z x tubex_test_win.zip -y
       - rm -Rf tubex_test_win.zip
       - cd tubex_test_win
       - rm -Rf ibex tubex ReadMe.txt
       - mv ../ibex .
       - mv ../tubex .
       - cd ..
       - 7z a -y tubex_test_x64_vc16.zip tubex_test_win
       - cd tubex_test_win/test
       - cmake -G "Visual Studio 16" -A x64 .
       - cmake --build . --config Release
       - cmd //c "Release\my_project.exe"
       - cd ../..
     deploy:
       <<: *deploy_base
       file: 
         - "*.zip"
         - "*.whl"

   - name: "Windows Visual Studio 2017 x86 C++"
     os: windows
     before_install: 
       - choco install -y winflexbison
     script: 
       - git clone -b develop https://github.com/lebarsfa/ibex-lib.git
       - cd ibex-lib
       - mkdir build ; cd build
       - cmake -G "Visual Studio 15" -A Win32 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_INSTALL_PREFIX="../../ibex" -D INTERVAL_LIB=filib ..
       - cmake --build . --config Release --target install
       - cd ../..
       - git clone -b windows https://github.com/lebarsfa/tubex-lib
       - cd tubex-lib 
       - git submodule init
       - git submodule update
       - mkdir build
       - cd build
       - cmake -G "Visual Studio 15" -A Win32 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" ..
       - cmake --build . --config Debug --target install
       - cd ../..
       # Test C++ program and bundle...
       - wget http://www.ensta-bretagne.fr/lebars/Share/tubex_test_win.zip
       - 7z x tubex_test_win.zip -y
       - rm -Rf tubex_test_win.zip
       - cd tubex_test_win
       - rm -Rf ibex tubex ReadMe.txt
       - mv ../ibex .
       - mv ../tubex .
       - cd ..
       - 7z a -y tubex_test_x86_vc15.zip tubex_test_win
       - cd tubex_test_win/test
       - cmake -G "Visual Studio 15" -A Win32 .
       - cmake --build . --config Release
       - cmd //c "Release\my_project.exe"
       - cd ../..
     deploy:
       <<: *deploy_base
       file: 
         - "*.zip"

   - name: "Windows Visual Studio 2017 x64 C++ Python 3.7"
     os: windows
     before_install: 
       - choco install -y winflexbison
       - cmd //c "choco install -y doxygen.install graphviz & choco install -y python --version=3.7.7 & refreshenv.cmd & python -m pip install --upgrade pip & pip install --upgrade pyIbex & pip install --upgrade wheel setuptools & git clone -b v3.1.1 https://github.com/sphinx-doc/sphinx & cd sphinx & pip install . & pip install --upgrade breathe sphinx-tabs sphinx_rtd_theme & refreshenv.cmd"
       - export PATH=/c/Python37:/c/Python37/Scripts:$PATH
     script: 
       - git clone -b develop https://github.com/lebarsfa/ibex-lib.git
       - cd ibex-lib
       - mkdir build ; cd build
       - cmake -G "Visual Studio 15" -A x64 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_INSTALL_PREFIX="../../ibex" -D INTERVAL_LIB=filib ..
       - cmake --build . --config Release --target install
       - cd ../..
       - git clone -b windows https://github.com/lebarsfa/tubex-lib
       - cd tubex-lib 
       - git submodule init
       - git submodule update
       - mkdir build
       - cd build
       - cmake -G "Visual Studio 15" -A x64 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" -D WITH_PYTHON=ON ..
       - cmake --build . --config Debug --target api
       - cmake -G "Visual Studio 15" -A x64 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" -D WITH_PYTHON=ON ..
       - cmake --build . --config Debug --target install
       - cmake --build . --config Debug --target pip_package
       # Test python program and wheel...
       - cp *.whl ../../tubex_lib-X.X.X-cp37-cp37m-win_amd64.whl
       - pip install ../../tubex_lib-X.X.X-cp37-cp37m-win_amd64.whl
       - python ../examples/tuto/01_getting_started/01_getting_started.py
       - cd ../..
       # Test C++ program and bundle...
       - wget http://www.ensta-bretagne.fr/lebars/Share/tubex_test_win.zip
       - 7z x tubex_test_win.zip -y
       - rm -Rf tubex_test_win.zip
       - cd tubex_test_win
       - rm -Rf ibex tubex ReadMe.txt
       - mv ../ibex .
       - mv ../tubex .
       - cd ..
       - 7z a -y tubex_test_x64_vc15.zip tubex_test_win
       - cd tubex_test_win/test
       - cmake -G "Visual Studio 15" -A x64 .
       - cmake --build . --config Release
       - cmd //c "Release\my_project.exe"
       - cd ../..
     deploy:
       <<: *deploy_base
       file: 
         - "*.zip"
         - "*.whl"

   - name: "Windows Visual Studio 2015 x86 C++ Python 3.6"
     os: windows
     before_install: 
       - choco install -y vcbuildtools -ia "/InstallSelectableItems Win81SDK_CppBuildSKUV1;VisualCppBuildTools_ATLMFC_SDK" winflexbison
       - cmd //c "choco install -y doxygen.install graphviz & choco install -y python --version=3.6.8 --x86 & refreshenv.cmd & python -m pip install --upgrade pip & pip install --upgrade pyIbex & pip install --upgrade wheel setuptools & git clone -b v3.1.1 https://github.com/sphinx-doc/sphinx & cd sphinx & pip install . & pip install --upgrade breathe sphinx-tabs sphinx_rtd_theme & refreshenv.cmd"
       - export PATH=/c/Python36:/c/Python36/Scripts:$PATH
     script: 
       - git clone -b develop https://github.com/lebarsfa/ibex-lib.git
       - cd ibex-lib
       - mkdir build ; cd build
       - cmake -G "Visual Studio 14" -A Win32 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_INSTALL_PREFIX="../../ibex" -D INTERVAL_LIB=filib ..
       - cmake --build . --config Release --target install
       - cd ../..
       - git clone -b windows https://github.com/lebarsfa/tubex-lib
       - cd tubex-lib 
       - git submodule init
       - git submodule update
       - mkdir build
       - cd build
       - cmake -G "Visual Studio 14" -A Win32 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" -D WITH_PYTHON=ON ..
       - cmake --build . --config Debug --target api
       - cmake -G "Visual Studio 14" -A Win32 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" -D WITH_PYTHON=ON ..
       - cmake --build . --config Debug --target install
       - cmake --build . --config Debug --target pip_package
       # Test python program and wheel...
       - cp *.whl ../../tubex_lib-X.X.X-cp36-cp36m-win32.whl
       - pip install ../../tubex_lib-X.X.X-cp36-cp36m-win32.whl
       - python ../examples/tuto/01_getting_started/01_getting_started.py
       - cd ../..
       # Test C++ program and bundle...
       - wget http://www.ensta-bretagne.fr/lebars/Share/tubex_test_win.zip
       - 7z x tubex_test_win.zip -y
       - rm -Rf tubex_test_win.zip
       - cd tubex_test_win
       - rm -Rf ibex tubex ReadMe.txt
       - mv ../ibex .
       - mv ../tubex .
       - cd ..
       - 7z a -y tubex_test_x86_vc14.zip tubex_test_win
       - cd tubex_test_win/test
       - cmake -G "Visual Studio 14" -A Win32 .
       - cmake --build . --config Release
       - cmd //c "Release\my_project.exe"
       - cd ../..
     deploy:
       <<: *deploy_base
       file: 
         - "*.zip"
         - "*.whl"

   - name: "Windows Visual Studio 2015 x86 Python 3.4"
     os: windows
     before_install: 
       - choco install -y vcbuildtools -ia "/InstallSelectableItems Win81SDK_CppBuildSKUV1;VisualCppBuildTools_ATLMFC_SDK" winflexbison
       - cmd //c "choco install -y doxygen.install graphviz & choco install -y python --version=3.4.4.20200110 --x86 & refreshenv.cmd & set PATH=C:\Python34;C:\Python34\Scripts;%PATH% & python -m pip install --upgrade pip==19.1.1 & pip install --upgrade pyIbex & pip install --upgrade wheel setuptools & refreshenv.cmd"
       - export PATH=/c/Python34:/c/Python34/Scripts:$PATH
     script: 
       - git clone -b develop https://github.com/lebarsfa/ibex-lib.git
       - cd ibex-lib
       - mkdir build ; cd build
       - cmake -G "Visual Studio 14" -A Win32 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_INSTALL_PREFIX="../../ibex" -D INTERVAL_LIB=filib ..
       - cmake --build . --config Release --target install
       - cd ../..
       - git clone -b windows https://github.com/lebarsfa/tubex-lib
       - cd tubex-lib 
       - git submodule init
       - git submodule update
       - mkdir build
       - cd build
       - cmake -G "Visual Studio 14" -A Win32 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" -D WITH_PYTHON=ON ..
       - cmake --build . --config Debug --target api
       - cmake -G "Visual Studio 14" -A Win32 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" -D WITH_PYTHON=ON ..
       - cmake --build . --config Debug --target install
       - cmake --build . --config Debug --target pip_package
       # Test python program and wheel...
       - cp *.whl ../../tubex_lib-X.X.X-cp34-cp34m-win32.whl
       - pip install ../../tubex_lib-X.X.X-cp34-cp34m-win32.whl
       - python ../examples/tuto/01_getting_started/01_getting_started.py
       - cd ../..
     deploy:
       <<: *deploy_base
       file: 
         - "*.whl"

   - name: "Windows Visual Studio 2015 x64 C++ Python 3.6"
     os: windows
     before_install: 
       - choco install -y vcbuildtools -ia "/InstallSelectableItems Win81SDK_CppBuildSKUV1;VisualCppBuildTools_ATLMFC_SDK" winflexbison
       - cmd //c "choco install -y doxygen.install graphviz & choco install -y python --version=3.6.8 & refreshenv.cmd & python -m pip install --upgrade pip & pip install --upgrade pyIbex & pip install --upgrade wheel setuptools & git clone -b v3.1.1 https://github.com/sphinx-doc/sphinx & cd sphinx & pip install . & pip install --upgrade breathe sphinx-tabs sphinx_rtd_theme & refreshenv.cmd"
       - export PATH=/c/Python36:/c/Python36/Scripts:$PATH
     script: 
       - git clone -b develop https://github.com/lebarsfa/ibex-lib.git
       - cd ibex-lib
       - mkdir build ; cd build
       - cmake -G "Visual Studio 14" -A x64 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_INSTALL_PREFIX="../../ibex" -D INTERVAL_LIB=filib ..
       - cmake --build . --config Release --target install
       - cd ../..
       - git clone -b windows https://github.com/lebarsfa/tubex-lib
       - cd tubex-lib 
       - git submodule init
       - git submodule update
       - mkdir build
       - cd build
       - cmake -G "Visual Studio 14" -A x64 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" -D WITH_PYTHON=ON ..
       - cmake --build . --config Debug --target api
       - cmake -G "Visual Studio 14" -A x64 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" -D WITH_PYTHON=ON ..
       - cmake --build . --config Debug --target install
       - cmake --build . --config Debug --target pip_package
       # Test python program and wheel...
       - cp *.whl ../../tubex_lib-X.X.X-cp36-cp36m-win_amd64.whl
       - pip install ../../tubex_lib-X.X.X-cp36-cp36m-win_amd64.whl
       - python ../examples/tuto/01_getting_started/01_getting_started.py
       - cd ../..
       # Test C++ program and bundle...
       - wget http://www.ensta-bretagne.fr/lebars/Share/tubex_test_win.zip
       - 7z x tubex_test_win.zip -y
       - rm -Rf tubex_test_win.zip
       - cd tubex_test_win
       - rm -Rf ibex tubex ReadMe.txt
       - mv ../ibex .
       - mv ../tubex .
       - cd ..
       - 7z a -y tubex_test_x64_vc14.zip tubex_test_win
       - cd tubex_test_win/test
       - cmake -G "Visual Studio 14" -A x64 .
       - cmake --build . --config Release
       - cmd //c "Release\my_project.exe"
       - cd ../..
     deploy:
       <<: *deploy_base
       file: 
         - "*.zip"
         - "*.whl"

   - name: "Windows Visual Studio 2015 x64 Python 3.5"
     os: windows
     before_install: 
       - choco install -y vcbuildtools -ia "/InstallSelectableItems Win81SDK_CppBuildSKUV1;VisualCppBuildTools_ATLMFC_SDK" winflexbison
       - cmd //c "choco install -y doxygen.install graphviz & choco install -y python --version=3.5.4.20200110 & refreshenv.cmd & python -m pip install --upgrade pip & pip install --upgrade pyIbex & pip install --upgrade wheel setuptools & git clone -b v3.1.1 https://github.com/sphinx-doc/sphinx & cd sphinx & pip install . & pip install --upgrade breathe sphinx-tabs sphinx_rtd_theme & refreshenv.cmd"
       - export PATH=/c/Python35:/c/Python35/Scripts:$PATH
     script: 
       - git clone -b develop https://github.com/lebarsfa/ibex-lib.git
       - cd ibex-lib
       - mkdir build ; cd build
       - cmake -G "Visual Studio 14" -A x64 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_INSTALL_PREFIX="../../ibex" -D INTERVAL_LIB=filib ..
       - cmake --build . --config Release --target install
       - cd ../..
       - git clone -b windows https://github.com/lebarsfa/tubex-lib
       - cd tubex-lib 
       - git submodule init
       - git submodule update
       - mkdir build
       - cd build
       - cmake -G "Visual Studio 14" -A x64 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" -D WITH_PYTHON=ON ..
       - cmake --build . --config Debug --target api
       - cmake -G "Visual Studio 14" -A x64 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" -D WITH_PYTHON=ON ..
       - cmake --build . --config Debug --target install
       - cmake --build . --config Debug --target pip_package
       # Test python program and wheel...
       - cp *.whl ../../tubex_lib-X.X.X-cp35-cp35m-win_amd64.whl
       - pip install ../../tubex_lib-X.X.X-cp35-cp35m-win_amd64.whl
       - python ../examples/tuto/01_getting_started/01_getting_started.py
       - cd ../..
     deploy:
       <<: *deploy_base
       file: 
         - "*.whl"

   - name: "Windows Visual Studio 2015 x64 Python 3.4"
     os: windows
     before_install: 
       - choco install -y vcbuildtools -ia "/InstallSelectableItems Win81SDK_CppBuildSKUV1;VisualCppBuildTools_ATLMFC_SDK" winflexbison
       - cmd //c "choco install -y doxygen.install graphviz & choco install -y python --version=3.4.4.20200110 & refreshenv.cmd & set PATH=C:\Python34;C:\Python34\Scripts;%PATH% & python -m pip install --upgrade pip==19.1.1 & pip install --upgrade pyIbex & pip install --upgrade wheel setuptools & refreshenv.cmd"
       - export PATH=/c/Python34:/c/Python34/Scripts:$PATH
     script: 
       - git clone -b develop https://github.com/lebarsfa/ibex-lib.git
       - cd ibex-lib
       - mkdir build ; cd build
       - cmake -G "Visual Studio 14" -A x64 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_INSTALL_PREFIX="../../ibex" -D INTERVAL_LIB=filib ..
       - cmake --build . --config Release --target install
       - cd ../..
       - git clone -b windows https://github.com/lebarsfa/tubex-lib
       - cd tubex-lib 
       - git submodule init
       - git submodule update
       - mkdir build
       - cd build
       - cmake -G "Visual Studio 14" -A x64 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" -D WITH_PYTHON=ON ..
       - cmake --build . --config Debug --target api
       - cmake -G "Visual Studio 14" -A x64 -D CMAKE_CXX_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_C_FLAGS=" /D WIN32 /EHsc /D _CRT_SECURE_NO_WARNINGS /wd4267 /wd4244 /wd4305" -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" -D WITH_PYTHON=ON ..
       - cmake --build . --config Debug --target install
       - cmake --build . --config Debug --target pip_package
       # Test python program and wheel...
       - cp *.whl ../../tubex_lib-X.X.X-cp34-cp34m-win_amd64.whl
       - pip install ../../tubex_lib-X.X.X-cp34-cp34m-win_amd64.whl
       - python ../examples/tuto/01_getting_started/01_getting_started.py
       - cd ../..
     deploy:
       <<: *deploy_base
       file: 
         - "*.whl"

   - name: "Windows Qt 5.12.6 MinGW 7.3.0 x86"
     os: windows
     before_install: 
       - choco uninstall -y mingw
         # Need to free up disk space...
       - df
       - rm -Rf "/C/Program Files (x86)/Microsoft Visual Studio/2017/BuildTools" || true
       - df
       - rm -Rf "/C/Program Files (x86)/Windows Kits" || true
       - df
       - rm -Rf "/C/Windows/SoftwareDistribution" || true
       - df
       - choco install -y winflexbison make patch
       - wget http://download.qt.io/archive/qt/5.12/5.12.6/qt-opensource-windows-x86-5.12.6.exe --no-check-certificate -nv
       - cmd //c "move /Y qt-opensource-windows-x86-5.12.6.exe %SystemDrive%\ "
       - wget http://www.ensta-bretagne.fr/lebars/Share/qt-installer-5.12.6-mingw73_32.qs --no-check-certificate -nv
       - cmd //c "move /Y qt-installer-5.12.6-mingw73_32.qs %SystemDrive%\ "
       - cmd //c netsh advfirewall set allprofiles state on
       - cmd //c netsh advfirewall firewall add rule name="Qt offline installer" dir=out action=block program="%SystemDrive%\qt-opensource-windows-x86-5.12.6.exe" enable=yes
         # Take several min... 
       - cmd //c "%SystemDrive%\qt-opensource-windows-x86-5.12.6.exe --script %SystemDrive%\qt-installer-5.12.6-mingw73_32.qs"
       - cmd //c netsh advfirewall firewall del rule name="Qt offline installer"
       - cmd //c netsh advfirewall set allprofiles state off
       - cmd //c "del /f /q %SystemDrive%\qt-opensource-windows-x86-5.12.6.exe"
       - df
     script: 
       - export PATH=/c/Qt/Qt5.12.6/Tools/mingw730_32/bin:$PATH
       - git clone -b develop https://github.com/lebarsfa/ibex-lib.git
       - cd ibex-lib
       - mkdir build ; cd build
       - cmake -G "MSYS Makefiles" -D CMAKE_INSTALL_PREFIX="../../ibex" -D CMAKE_CXX_FLAGS="-fPIC" -D CMAKE_C_FLAGS="-fPIC" -D INTERVAL_LIB=filib ..
       - cmake --build . --target install
       - cd ../..
       - git clone -b windows https://github.com/lebarsfa/tubex-lib
       - cd tubex-lib 
       - git submodule init
       - git submodule update
       - mkdir build
       - cd build
       - cmake -G "MSYS Makefiles" -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" -D CMAKE_BUILD_TYPE=Debug ..
       - cmake --build . --target install
       - cd ../..
       # Test C++ program and bundle...
       - wget http://www.ensta-bretagne.fr/lebars/Share/tubex_test_win.zip
       - 7z x tubex_test_win.zip -y
       - rm -Rf tubex_test_win.zip
       - cd tubex_test_win
       - rm -Rf ibex tubex
       - mv ../ibex .
       - mv ../tubex .
       - cd ..
       - 7z a -y tubex_test_x86_mingw7.zip tubex_test_win
       - cd tubex_test_win/test
       - cmake -G "MSYS Makefiles" .
       - cmake --build .
       - ./my_project.exe
       - cd ../..
     deploy:
       <<: *deploy_base
       file: 
         - "*.zip"

   - name: "Windows MinGW 8.1.0 x64"
     os: windows
     before_install: 
       - choco install -y winflexbison make patch
     script: 
       - git clone -b develop https://github.com/lebarsfa/ibex-lib.git
       - cd ibex-lib
       - mkdir build ; cd build
       - cmake -G "MSYS Makefiles" -D CMAKE_INSTALL_PREFIX="../../ibex" -D CMAKE_CXX_FLAGS="-fPIC" -D CMAKE_C_FLAGS="-fPIC" -D INTERVAL_LIB=filib ..
       - cmake --build . --target install
       - cd ../..
       - git clone -b windows https://github.com/lebarsfa/tubex-lib
       - cd tubex-lib 
       - git submodule init
       - git submodule update
       - mkdir build
       - cd build
       - cmake -G "MSYS Makefiles" -D CMAKE_PREFIX_PATH="../ibex" -D CMAKE_INSTALL_PREFIX="../../tubex" ..
       - cmake --build . --target install
       - cd ../..
       # Test C++ program and bundle...
       - wget http://www.ensta-bretagne.fr/lebars/Share/tubex_test_win.zip
       - 7z x tubex_test_win.zip -y
       - rm -Rf tubex_test_win.zip
       - cd tubex_test_win
       - rm -Rf ibex tubex
       - mv ../ibex .
       - mv ../tubex .
       - cd ..
       - 7z a -y tubex_test_x64_mingw8.zip tubex_test_win
       - cd tubex_test_win/test
       - cmake -G "MSYS Makefiles" .
       - cmake --build .
       - ./my_project.exe
       - cd ../..
     deploy:
       <<: *deploy_base
       file: 
         - "*.zip"
